<?xml version="1.0" encoding="UTF-8"?>
<features xmlns="http://karaf.apache.org/xmlns/features/v1.4.0" name="${project.artifactId}-${project.version}" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://karaf.apache.org/xmlns/features/v1.4.0 http://karaf.apache.org/xmlns/features/v1.4.0">
	<repository>mvn:org.apache.karaf.features/standard/${org.apache.karaf.features_standard.version}/xml/features</repository>
	<repository>mvn:${project.groupId}/net.osgiliath.feature.pax-web/${project.version}/xml/features</repository>
	<feature name="osgiliath-scr" description="Declarative Service support" version="${org.apache.karaf.features_standard.version}">
        <bundle start-level="30" dependency="true">mvn:org.apache.felix/org.apache.felix.metatype/${org.apache.felix_org.apache.felix.metatype.version}</bundle>
        <!-- wasn't dep=true --><bundle start-level="30" dependency="true">mvn:org.apache.felix/org.apache.felix.scr/${org.apache.felix_org.apache.felix.scr.version}</bundle>
        <!-- wasn't dep=true --><bundle start-level="30" dependency="true">mvn:org.apache.felix/org.apache.felix.scr.compat/${org.apache.felix_org.apache.felix.scr.compat.version}</bundle>
        <conditional>
           <condition>management</condition>
           <bundle start-level="30">mvn:org.apache.karaf.scr/org.apache.karaf.scr.management/${org.apache.karaf.scr_org.apache.karaf.scr.management.version}</bundle>
        </conditional>
        <conditional>
            <condition>webconsole</condition>
            <bundle start-level="30">mvn:org.apache.felix/org.apache.felix.inventory/${org.apache.felix_org.apache.felix.inventory.version}</bundle>
            <bundle start-level="30">mvn:org.apache.felix/org.apache.felix.webconsole.plugins.ds/${org.apache.felix_org.apache.felix.webconsole.plugins.ds.version}</bundle>
        </conditional>
        <capability>
            osgi.service;effective:=active;objectClass=org.apache.felix.scr.ScrService,
            osgi.extender;osgi.extender="osgi.component";uses:="org.osgi.service.component";version:Version="1.2.1"
        </capability>
    </feature>
    
    <feature name="osgiliath-jetty" version="${org.eclipse.jetty.version}">
        <feature prerequisite="false" dependency="false">osgiliath-pax-jetty</feature>
    </feature>
    
    <feature name="osgiliath-http" description="Implementation of the OSGI HTTP Service" version="${org.apache.karaf.features_standard.version}">
        <feature dependency="true">osgiliath-pax-http-service</feature>
        <requirement>http-service</requirement>
    </feature>
    <feature name="osgiliath-pax-http-service" description="Pax-Web OSGi HTTP Service" version="${org.apache.karaf.features_standard.version}">
        <feature>osgiliath-pax-http</feature>
        <bundle start-level="30">mvn:org.apache.karaf.http/org.apache.karaf.http.core/${org.apache.karaf.http_org.apache.karaf.http.core.version}</bundle>
        <capability>http-service;provider:=pax-http</capability>
        <conditional>
            <condition>webconsole</condition>
            <bundle start-level="30">mvn:org.apache.karaf.webconsole/org.apache.karaf.webconsole.http/${org.apache.karaf.webconsole_org.apache.karaf.webconsole.http.version}</bundle>
        </conditional>
    </feature>
    <feature name="osgiliath-http-whiteboard" description="Provide HTTP Whiteboard pattern support" version="${org.apache.karaf.features_standard.version}">
    	<feature>osgiliath-http</feature>
        <feature>osgiliath-pax-http-whiteboard</feature>
    </feature>
    <feature name="osgiliath-war" description="Turn Karaf as a full WebContainer" version="${org.apache.karaf.features_standard.version}">
        <feature prerequisite="false" dependency="false">osgiliath-http</feature>
        <feature prerequisite="false" dependency="false">osgiliath-pax-war</feature>
        <bundle start-level="30">mvn:org.apache.karaf.web/org.apache.karaf.web.core/${org.apache.karaf.web_org.apache.karaf.web.core.version}</bundle>
    </feature>
    <feature name="osgiliath-jolokia" description="Jolokia monitoring support" version="/${org.jolokia_jolokia-osgi.version}">
        <config name="org.jolokia.osgi" append="false">
            org.jolokia.user=karaf
            org.jolokia.realm=karaf
            org.jolokia.authMode=jaas
        </config>
        <feature prerequisite="false" dependency="false">osgiliath-http</feature>
        <bundle>mvn:org.jolokia/jolokia-osgi/${org.jolokia_jolokia-osgi.version}</bundle>
    </feature>
</features>